repeat wait() until game:IsLoaded() -- ƒê·ª£i game t·∫£i xong
wait(1) -- ƒê·ª£i load d·ªØ li·ªáu ƒë·∫ßy ƒë·ªß

local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local StarterGui = game:GetService("StarterGui")
local TweenService = game:GetService("TweenService") -- D√πng ƒë·ªÉ bay m∆∞·ª£t m√†
local LocalPlayer = Players.LocalPlayer

-- üè¥ **Ch·ªçn team Pirates tr∆∞·ªõc khi hi·ªÉn th·ªã UI**
local function selectPirateTeam()
    if LocalPlayer.Team and LocalPlayer.Team.Name == "Pirates" then
        return
    end

    local remote = ReplicatedStorage:WaitForChild("Remotes", 5)
    if remote then
        local teamSelect = remote:FindFirstChild("TeamSelect")
        if teamSelect then
            teamSelect:InvokeServer("Pirates")
            wait(2)
        end
    end
end

selectPirateTeam() -- Ch·∫°y ngay khi game load xong

-- üìå **T·∫°o UI sau khi ƒë√£ ch·ªçn team**
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
local Frame = Instance.new("Frame", ScreenGui)
local Title = Instance.new("TextLabel", Frame)
local Logo = Instance.new("ImageLabel", Frame)
local FruitStatus = Instance.new("TextLabel", Frame) -- Tr·∫°ng th√°i tr√°i
local TimerLabel = Instance.new("TextLabel", Frame) -- B·ªô ƒë·∫øm 5 gi√¢y ƒë·ªïi server

ScreenGui.Name = "PlowGameUI"
Frame.Size = UDim2.new(0, 350, 0, 80)
Frame.Position = UDim2.new(0.5, -175, 0.05, 0)
Frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
Frame.BorderSizePixel = 2
Frame.BackgroundTransparency = 0.2

Title.Size = UDim2.new(1, -50, 0, 30)
Title.Position = UDim2.new(0, 50, 0, 5)
Title.Text = "Plow Game | Community"
Title.TextScaled = true
Title.TextColor3 = Color3.fromRGB(180, 100, 255)
Title.BackgroundTransparency = 1
Title.Font = Enum.Font.SourceSansBold

Logo.Size = UDim2.new(0, 40, 0, 40)
Logo.Position = UDim2.new(0, 5, 0, 5)
Logo.Image = "rbxassetid://100439996681560"
Logo.BackgroundTransparency = 1

FruitStatus.Size = UDim2.new(1, -20, 0, 20)
FruitStatus.Position = UDim2.new(0, 10, 0, 35)
FruitStatus.Text = "Tr·∫°ng th√°i: ƒêang ki·ªÉm tra..."
FruitStatus.TextScaled = true
FruitStatus.TextColor3 = Color3.fromRGB(0, 255, 0)
FruitStatus.BackgroundTransparency = 1
FruitStatus.Font = Enum.Font.SourceSansBold

TimerLabel.Size = UDim2.new(1, -20, 0, 20)
TimerLabel.Position = UDim2.new(0, 10, 0, 55)
TimerLabel.Text = "Hop server sau: 5 gi√¢y"
TimerLabel.TextScaled = true
TimerLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
TimerLabel.BackgroundTransparency = 1
TimerLabel.Font = Enum.Font.SourceSansBold

-- üçè **T√¨m Fruit g·∫ßn nh·∫•t**
local function findNearestFruit()
    for _, fruit in pairs(Workspace:GetChildren()) do
        if fruit:IsA("Model") and fruit.Name:find("Fruit") and fruit:FindFirstChild("Handle") then
            return fruit
        end
    end
    return nil
end

-- üöÄ **D√πng TweenService ƒë·ªÉ bay ƒë·∫øn Fruit m∆∞·ª£t m√†**
local function smoothTeleport(targetPosition)
    local character = LocalPlayer.Character
    if character and character:FindFirstChild("HumanoidRootPart") then
        local rootPart = character.HumanoidRootPart
        local tweenInfo = TweenInfo.new(2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out) -- Bay m∆∞·ª£t trong 2 gi√¢y
        local tween = TweenService:Create(rootPart, tweenInfo, {CFrame = targetPosition})
        tween:Play()
        wait(2.5) -- ƒê·ª£i ƒë·∫£m b·∫£o di chuy·ªÉn ho√†n t·∫•t
    end
end

-- üéí **L∆∞u Fruit v√†o Inventory**
local function storeFruitInInventory(fruit)
    if fruit and fruit:FindFirstChild("Handle") then
        local args = {
            [1] = fruit.Name,
            [2] = fruit.Handle.Position
        }

        local maxAttempts = 5
        local attempt = 0
        local success = false

        while attempt < maxAttempts do
            local successCall, result = pcall(function()
                return ReplicatedStorage.Remotes:FindFirstChild("StoreFruit"):InvokeServer(unpack(args))
            end)

            if successCall then
                success = true
                break
            else
                attempt = attempt + 1
                warn("[StoreFruit]: Th·ª≠ l·∫ßn " .. attempt .. " th·∫•t b·∫°i! ƒêang th·ª≠ l·∫°i...")
                wait(1)
            end
        end

        return success
    end
    return false
end

-- üîÑ **ƒê·ªïi server sau 5 gi√¢y**
local function switchServer()
    for i = 5, 1, -1 do
        TimerLabel.Text = "Hop server sau: " .. i .. " gi√¢y"
        wait(1)
    end

    TeleportService:Teleport(game.PlaceId, LocalPlayer)
end

-- üîç **T√¨m & Nh·∫∑t Fruit**
local function checkAndPickFruit()
    local fruit = findNearestFruit()

    if fruit then
        FruitStatus.Text = "Tr·∫°ng th√°i: ƒê√£ t√¨m th·∫•y Fruit! " .. fruit.Name
        smoothTeleport(fruit.Handle.CFrame) -- Bay ƒë·∫øn fruit
        wait(1)
        if storeFruitInInventory(fruit) then
            FruitStatus.Text = "Tr·∫°ng th√°i: Fruit ƒë√£ l∆∞u v√†o inventory!"
        else
            FruitStatus.Text = "Tr·∫°ng th√°i: Kh√¥ng th·ªÉ l∆∞u Fruit!"
        end
    else
        FruitStatus.Text = "Tr·∫°ng th√°i: Kh√¥ng c√≥ Fruit!"
        switchServer()
    end
end

checkAndPickFruit()
