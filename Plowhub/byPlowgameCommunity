-- Kiá»ƒm tra khi game Ä‘Ã£ load xong
repeat wait() until game:IsLoaded()

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local VirtualUser = game:GetService("VirtualUser")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")

-- Kiá»ƒm tra xem cÃ³ pháº£i lÃ  KRNL PE hay khÃ´ng
local isKRNL = pcall(function()
    return game:GetService("CoreGui"):FindFirstChild("KRNL") -- Kiá»ƒm tra xem cÃ³ Ä‘á»‘i tÆ°á»£ng KRNL trong CoreGui
end)

-- Cháº·n AFK
LocalPlayer.Idled:Connect(function()
    if isKRNL then
        VirtualUser:CaptureController()
        VirtualUser:ClickButton2(Vector2.new())
    end
end)

-- Táº¡o UI hiá»ƒn thá»‹ trÃªn mÃ n hÃ¬nh
local function CreateUI()
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "PlowHubUI"
    screenGui.Parent = game.Players.LocalPlayer:FindFirstChild("PlayerGui") or game.CoreGui

    local Frame = Instance.new("Frame", screenGui)
    Frame.Size = UDim2.new(0, 320, 0, 200)  -- TÄƒng chiá»u cao má»™t chÃºt
    Frame.Position = UDim2.new(0.5, -160, 0.05, 0)
    Frame.BackgroundColor3 = Color3.new(0, 0, 0)
    Frame.BackgroundTransparency = 0.3
    Frame.BorderSizePixel = 2
    Frame.ClipsDescendants = true  -- Äáº£m báº£o ná»™i dung khÃ´ng vÆ°á»£t ra ngoÃ i Frame

    -- TiÃªu Ä‘á» UI
    local Title = Instance.new("TextLabel", Frame)
    Title.Size = UDim2.new(1, 0, 0.2, 0)
    Title.TextScaled = true
    Title.TextColor3 = Color3.fromRGB(173, 216, 230)
    Title.BackgroundTransparency = 1
    Title.Text = "ğŸŒ Plow Game | Community"

    -- Khung Tráº¡ng thÃ¡i trÃ¡i Ã¡c quá»·
    local StatusFrame = Instance.new("Frame", Frame)
    StatusFrame.Size = UDim2.new(0.9, 0, 0.4, 0)
    StatusFrame.Position = UDim2.new(0.05, 0, 0.3, 0)
    StatusFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    StatusFrame.BackgroundTransparency = 0.2

    -- TextLabel cho tráº¡ng thÃ¡i
    local StatusLabel = Instance.new("TextLabel", StatusFrame)
    StatusLabel.Size = UDim2.new(1, 0, 1, 0)
    StatusLabel.TextSize = 18
    StatusLabel.TextColor3 = Color3.new(1, 1, 1)
    StatusLabel.BackgroundTransparency = 1
    StatusLabel.TextWrapped = true  -- Báº­t tÃ­nh nÄƒng tá»± Ä‘á»™ng xuá»‘ng dÃ²ng
    StatusLabel.Text = "ğŸ” Äang kiá»ƒm tra trÃ¡i Ã¡c quá»·..."

    -- FPS Counter
    local FpsLabel = Instance.new("TextLabel", Frame)
    FpsLabel.Size = UDim2.new(1, 0, 0.15, 0)
    FpsLabel.Position = UDim2.new(0, 0, 0.75, 0)
    FpsLabel.TextSize = 16
    FpsLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
    FpsLabel.BackgroundTransparency = 1
    FpsLabel.Text = "FPS: 60"

    -- Bá»™ Ä‘áº¿m thá»i gian
    local TimerLabel = Instance.new("TextLabel", Frame)
    TimerLabel.Size = UDim2.new(1, 0, 0.15, 0)
    TimerLabel.Position = UDim2.new(0, 0, 0.9, 0)
    TimerLabel.TextSize = 16
    TimerLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
    TimerLabel.BackgroundTransparency = 1
    TimerLabel.Text = "Thá»i gian: 5s"

    -- Cáº­p nháº­t FPS theo thá»i gian thá»±c
    RunService.RenderStepped:Connect(function()
        local fps = math.floor(1 / RunService.RenderStepped:Wait())
        FpsLabel.Text = "FPS: " .. fps
    end)

    return StatusLabel, TimerLabel
end

-- Khá»Ÿi táº¡o UI
local StatusLabel, TimerLabel = CreateUI()

-- Dá»‹ch chuyá»ƒn Ä‘áº¿n trÃ¡i
local function TeleportToPosition(position)
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        LocalPlayer.Character.HumanoidRootPart.CFrame = position
    end
end

-- TÃ¬m & nháº·t trÃ¡i
local function FindFruits()
    for _, fruit in pairs(game.Workspace:GetChildren()) do
        if fruit:IsA("Tool") and string.find(fruit.Name, "Fruit") then
            return fruit
        end
    end
    return nil
end

-- LÆ°u trá»¯ trÃ¡i vÃ o kho
local function StoreFruit(fruitName)
    local success, message = pcall(function()
        return ReplicatedStorage.Remotes.CommF_:InvokeServer("StoreFruit", fruitName)
    end)
    
    if success then
        -- Kiá»ƒm tra trÃ¡i Ä‘Ã£ lÆ°u vÃ o kho chÆ°a
        local isStored = IsFruitStored(fruitName)
        if isStored then
            StatusLabel.Text = "âœ… ÄÃ£ lÆ°u trá»¯ trÃ¡i " .. fruitName .. "!"
        else
            StatusLabel.Text = "Error store fruitâš ï¸"
        end
    else
        StatusLabel.Text = "Error store fruitâš ï¸"
    end
end

-- Kiá»ƒm tra trÃ¡i Ã¡c quá»· Ä‘Ã£ lÆ°u vÃ o rÆ°Æ¡ng chÆ°a
local function IsFruitStored(fruitName)
    local success, result = pcall(function()
        return ReplicatedStorage.Remotes.CommF_:InvokeServer("GetStoredFruits") -- HÃ m giáº£ Ä‘á»‹nh láº¥y danh sÃ¡ch trÃ¡i Ä‘Ã£ lÆ°u
    end)

    if success then
        for _, storedFruit in pairs(result) do
            if storedFruit == fruitName then
                return true
            end
        end
    end

    return false
end

-- Bá»™ Ä‘áº¿m thá»i gian Ä‘áº¿m ngÆ°á»£c
local function StartCountdown()
    local countdown = 5
    while countdown > 0 do
        TimerLabel.Text = "Thá»i gian: " .. countdown .. "s"
        wait(1)
        countdown = countdown - 1
    end
end

-- Tá»± Ä‘á»™ng chuyá»ƒn server (Server Hop)
local function ServerHopWithCountdown()
    local serverIds = {
        1793, 3900, 2570, 9370, 5866, 7745, 3469, 2400, 8693, 4312, 3629, 1990, 7247, 2173, 1767, 7306, 6740, 1085, 8357
    }
    local randomServerId = serverIds[math.random(1, #serverIds)] -- Chá»n server ngáº«u nhiÃªn tá»« danh sÃ¡ch
    local success, err = pcall(function()
        TeleportService:Teleport(randomServerId, LocalPlayer)
    end)
    if success then
        StatusLabel.Text = "ğŸŒ Äang chuyá»ƒn sang server má»›i..."
    else
        StatusLabel.Text = "âŒ KhÃ´ng thá»ƒ chuyá»ƒn server."
    end
end

-- TÃ¬m & nháº·t trÃ¡i, sau Ä‘Ã³ tá»± Ä‘á»™ng Server Hop vá»›i Ä‘áº¿m ngÆ°á»£c
while true do
    local fruit = FindFruits()
    if fruit then
        StatusLabel.Text = "ğŸ ÄÃ£ tÃ¬m tháº¥y trÃ¡i Ã¡c quá»·!"
        TeleportToPosition(fruit.Handle.CFrame)
        wait(1)

        -- Nháº·t trÃ¡i & lÆ°u vÃ o kho
        StoreFruit(fruit.Name)
        wait(5) -- Äá»£i 5 giÃ¢y trÆ°á»›c khi kiá»ƒm tra láº¡i

        -- Kiá»ƒm tra sau khi lÆ°u trá»¯
        UpdateStatusForUnstoredFruit(fruit)
        StartCountdown()
        ServerHopWithCountdown()
    else
        StatusLabel.Text = "ğŸ” KhÃ´ng tÃ¬m tháº¥y trÃ¡i Ã¡c quá»·."
        wait(2) -- Äá»£i má»™t lÃºc trÆ°á»›c khi tÃ¬m láº¡i trÃ¡i
    end
end
