-- Kiá»ƒm tra khi game Ä‘Ã£ load xong
repeat wait() until game:IsLoaded()

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local VirtualUser = game:GetService("VirtualUser")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")

-- ğŸ”„ğŸ± Cháº·n AFK
LocalPlayer.Idled:Connect(function()
    VirtualUser:CaptureController()
    VirtualUser:ClickButton2(Vector2.new())
end)

-- ğŸ´ Tá»± Ä‘á»™ng chá»n Háº£i Táº·c khi vÃ o game
if game.PlaceId == 2753915549 or game.PlaceId == 4442272183 or game.PlaceId == 7449423635 then
    local args = { [1] = "SetTeam", [2] = "Pirates" }
    ReplicatedStorage.Remotes.CommF_:InvokeServer(unpack(args))
    wait(1)
    ReplicatedStorage.Remotes.CommF_:InvokeServer("TeleportToSpawn")
end

-- ğŸ“Œ Táº¡o UI hiá»ƒn thá»‹ trÃªn mÃ n hÃ¬nh
local function CreateUI()
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "PlowHubUI"
    screenGui.Parent = game.Players.LocalPlayer:FindFirstChild("PlayerGui") or game.CoreGui

    local Frame = Instance.new("Frame", screenGui)
    Frame.Size = UDim2.new(0, 320, 0, 200)  -- TÄƒng chiá»u cao má»™t chÃºt
    Frame.Position = UDim2.new(0.5, -160, 0.05, 0)
    Frame.BackgroundColor3 = Color3.new(0, 0, 0)
    Frame.BackgroundTransparency = 0.3
    Frame.BorderSizePixel = 2
    Frame.ClipsDescendants = true  -- Äáº£m báº£o ná»™i dung khÃ´ng vÆ°á»£t ra ngoÃ i Frame

    -- ğŸŒ TiÃªu Ä‘á» UI
    local Title = Instance.new("TextLabel", Frame)
    Title.Size = UDim2.new(1, 0, 0.2, 0)
    Title.TextScaled = true
    Title.TextColor3 = Color3.fromRGB(173, 216, 230)
    Title.BackgroundTransparency = 1
    Title.Text = "ğŸŒ Plow Game | Community"

    -- ğŸ” Khung Tráº¡ng thÃ¡i trÃ¡i Ã¡c quá»·
    local StatusFrame = Instance.new("Frame", Frame)
    StatusFrame.Size = UDim2.new(0.9, 0, 0.4, 0)
    StatusFrame.Position = UDim2.new(0.05, 0, 0.3, 0)
    StatusFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    StatusFrame.BackgroundTransparency = 0.2

    -- ğŸ“‘ TextLabel cho tráº¡ng thÃ¡i vá»›i TextWrapped
    local StatusLabel = Instance.new("TextLabel", StatusFrame)
    StatusLabel.Size = UDim2.new(1, 0, 1, 0)
    StatusLabel.TextSize = 18
    StatusLabel.TextColor3 = Color3.new(1, 1, 1)
    StatusLabel.BackgroundTransparency = 1
    StatusLabel.TextWrapped = true  -- Báº­t tÃ­nh nÄƒng tá»± Ä‘á»™ng xuá»‘ng dÃ²ng
    StatusLabel.Text = "ğŸ” Äang kiá»ƒm tra trÃ¡i Ã¡c quá»·..."

    -- ğŸ¯ FPS Counter
    local FpsLabel = Instance.new("TextLabel", Frame)
    FpsLabel.Size = UDim2.new(1, 0, 0.15, 0)
    FpsLabel.Position = UDim2.new(0, 0, 0.75, 0)
    FpsLabel.TextSize = 16
    FpsLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
    FpsLabel.BackgroundTransparency = 1
    FpsLabel.Text = "FPS: 60"

    -- ğŸ¯ Cáº­p nháº­t FPS theo thá»i gian thá»±c
    RunService.RenderStepped:Connect(function()
        local fps = math.floor(1 / RunService.RenderStepped:Wait())
        FpsLabel.Text = "FPS: " .. fps
    end)

    return StatusLabel
end

-- ğŸ“Œ Khá»Ÿi táº¡o UI
local StatusLabel = CreateUI()

-- ğŸ“ Dá»‹ch chuyá»ƒn Ä‘áº¿n trÃ¡i
local function TeleportToPosition(position)
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        LocalPlayer.Character.HumanoidRootPart.CFrame = position
    end
end

-- ğŸ” TÃ¬m & nháº·t trÃ¡i
local function FindFruits()
    for _, fruit in pairs(game.Workspace:GetChildren()) do
        if fruit:IsA("Tool") and string.find(fruit.Name, "Fruit") then
            return fruit
        end
    end
    return nil
end

-- âœ… LÆ°u trá»¯ trÃ¡i vÃ o kho
local function StoreFruit(fruitName)
    ReplicatedStorage.Remotes.CommF_:InvokeServer("StoreFruit", fruitName)
    StatusLabel.Text = "âœ… ÄÃ£ lÆ°u trá»¯ trÃ¡i " .. fruitName .. "!"
end

-- ğŸŒ **Cáº£i tiáº¿n Server Hop vá»›i bá»™ lá»c vÃ  hiá»‡u suáº¥t cao hÆ¡n**
local function ServerHopWithImprovedLogic()
    local attempts = 0
    local maxAttempts = 5 -- Tá»‘i Ä‘a 5 láº§n thá»­

    while attempts < maxAttempts do
        attempts = attempts + 1
        StatusLabel.Text = "ğŸ”„ Äang tÃ¬m server... (Láº§n thá»­: " .. attempts .. ")"

        local success, response = pcall(function()
            return game:HttpGet("https://games.roblox.com/v1/games/2753915549/servers/Public?sortOrder=Asc&limit=100")
        end)

        if not success then
            StatusLabel.Text = "âŒ KhÃ´ng thá»ƒ láº¥y thÃ´ng tin server. Thá»­ láº¡i sau..."
            return
        end

        local servers = HttpService:JSONDecode(response).data
        local viableServers = {}

        -- Lá»c cÃ¡c server cÃ³ Ã­t ngÆ°á»i chÆ¡i vÃ  khÃ´ng Ä‘áº§y
        for _, server in ipairs(servers) do
            if server.playing < server.maxPlayers then
                table.insert(viableServers, server)
            end
        end

        -- Náº¿u tÃ¬m tháº¥y server kháº£ dá»¥ng
        if #viableServers > 0 then
            local chosenServer = viableServers[math.random(1, #viableServers)] -- Chá»n server ngáº«u nhiÃªn tá»« danh sÃ¡ch kháº£ dá»¥ng
            StatusLabel.Text = "ğŸ” Äang chuyá»ƒn Ä‘áº¿n server má»›i..."
            TeleportService:TeleportToPlaceInstance(game.PlaceId, chosenServer.id, LocalPlayer)
            return
        else
            StatusLabel.Text = "âŒ KhÃ´ng tÃ¬m tháº¥y server kháº£ dá»¥ng. Thá»­ láº¡i..."
            wait(3) -- Thá»­ láº¡i sau 3 giÃ¢y
        end
    end

    -- Náº¿u sau khi thá»­ háº¿t cÃ¡c láº§n mÃ  khÃ´ng thÃ nh cÃ´ng
    StatusLabel.Text = "âŒ KhÃ´ng thá»ƒ tÃ¬m tháº¥y server sau " .. maxAttempts .. " láº§n thá»­!"
end

-- ğŸŒ **Tá»± Ä‘á»™ng tham gia server thÃ´ng thÆ°á»ng**
local function AutoJoinServer()
    StatusLabel.Text = "ğŸ”„ TÃ¬m server cÃ´ng khai Ä‘á»ƒ tham gia..."
    
    local success, response = pcall(function()
        return game:HttpGet("https://games.roblox.com/v1/games/2753915549/servers/Public?sortOrder=Asc&limit=10")
    end)

    if success then
        local servers = HttpService:JSONDecode(response).data
        if #servers > 0 then
            local server = servers[math.random(1, #servers)] -- Chá»n ngáº«u nhiÃªn server trong danh sÃ¡ch
            StatusLabel.Text = "ğŸ” Äang tham gia server..."
            TeleportService:TeleportToPlaceInstance(game.PlaceId, server.id, LocalPlayer)
        else
            StatusLabel.Text = "âŒ KhÃ´ng tÃ¬m tháº¥y server cÃ´ng khai!"
        end
    else
        StatusLabel.Text = "âŒ KhÃ´ng thá»ƒ láº¥y danh sÃ¡ch server!"
    end
end

-- ğŸ” **TÃ¬m & nháº·t trÃ¡i, sau Ä‘Ã³ tá»± Ä‘á»™ng Server Hop vá»›i Ä‘áº¿m ngÆ°á»£c**
while true do
    local fruit = FindFruits()
    if fruit then
        StatusLabel.Text = "ğŸ ÄÃ£ tÃ¬m tháº¥y trÃ¡i Ã¡c quá»·!"
        TeleportToPosition(fruit.Handle.CFrame)
        wait(1)

        -- ğŸ† Nháº·t trÃ¡i & lÆ°u vÃ o kho
        LocalPlayer.Character.Humanoid:EquipTool(fruit)
        wait(1)
        StoreFruit(fruit.Name)
    else
        StatusLabel.Text = "âŒ KhÃ´ng cÃ³ trÃ¡i! Chuáº©n bá»‹ chuyá»ƒn server..."
        -- Äá»£i 5 giÃ¢y trÆ°á»›c khi tá»± Ä‘á»™ng server hop
        for i = 5, 1, -1 do
            StatusLabel.Text = "ğŸ”„ Chuyá»ƒn server sau " .. i .. " giÃ¢y..."
            wait(1)
        end

        -- Sau khi Ä‘áº¿m 5 giÃ¢y, thá»±c hiá»‡n server hop hoáº·c tham gia server cÃ´ng khai
        ServerHopWithImprovedLogic()
        AutoJoinServer()  -- ThÃªm chá»©c nÄƒng tham gia server cÃ´ng khai khi khÃ´ng tÃ¬m tháº¥y trÃ¡i
    end

    wait(5) -- â³ Chá» 5 giÃ¢y trÆ°á»›c khi kiá»ƒm tra tiáº¿p
end
