repeat wait() until game:IsLoaded()
wait(1)

local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer

-- ğŸ”¥ Tá»± Ä‘á»™ng nháº­n diá»‡n executor
local executor = identifyexecutor and identifyexecutor() or "Unknown"
print("ğŸ” Äang cháº¡y trÃªn Executor: " .. executor)

-- ğŸ´ Fix Join Team Pirates (Cháº¯c cháº¯n vÃ o Team)
local function selectPirateTeam()
    if LocalPlayer.Team and LocalPlayer.Team.Name == "Pirates" then
        return
    end

    local remote = ReplicatedStorage:WaitForChild("Remotes", 5)
    if remote then
        local teamSelect = remote:FindFirstChild("TeamSelect")
        if teamSelect then
            for attempt = 1, 10 do
                if LocalPlayer.Team and LocalPlayer.Team.Name == "Pirates" then
                    print("âœ… ÄÃ£ vÃ o Team Pirates!")
                    return
                end

                print("ğŸ”„ Thá»­ vÃ o Team Pirates... (Láº§n " .. attempt .. ")")
                teamSelect:InvokeServer("Pirates")
                wait(2)
            end
        end
    end

    warn("âš ï¸ Lá»—i vÃ o team! Äang reset nhÃ¢n váº­t Ä‘á»ƒ thá»­ láº¡i...")
    LocalPlayer.Character:BreakJoints()
    wait(5)
    selectPirateTeam()
end

selectPirateTeam() -- Cháº¡y trÆ°á»›c khi UI xuáº¥t hiá»‡n

-- ğŸ›¡ Anti Ban (Plow Anti-Ban)
local function antiBan()
    if setfflag then
        setfflag("HumanoidParallelRemoveNoPhysics", "False")
        setfflag("HumanoidParallelRemoveNoPhysicsNoSimulate2", "False")
        setfflag("CrashPadUploadToBacktraceToBacktraceBaseUrl", "")
    end

    if setscriptable then
        setscriptable(game, "HttpGet", false)
        setscriptable(game, "HttpPost", false)
    end

    print("ğŸ›¡ Anti Ban ÄÃ£ KÃ­ch Hoáº¡t!")
end

antiBan()

-- ğŸ® Há»— trá»£ PE (Mobile Executor)
if executor == "Fluxus" or executor == "Hydrogen" or executor == "Arceus X" then
    getgenv = function() return _G end -- Fix lá»—i KRNL/PE khÃ´ng cÃ³ getgenv
end

-- ğŸš€ Giá»¯ FPS á»•n Ä‘á»‹nh cho Mobile & Low-End PC
if setfpscap then
    setfpscap(30) -- Giá»¯ FPS á»•n Ä‘á»‹nh
end

-- ğŸ” TÃ¬m fruit gáº§n nháº¥t
local function findNearestFruit()
    for _, fruit in pairs(Workspace:GetChildren()) do
        if fruit:IsA("Model") and fruit.Name:find("Fruit") and fruit:FindFirstChild("Handle") then
            return fruit
        end
    end
    return nil
end

-- ğŸš€ Tá»± Ä‘á»™ng bay Ä‘áº¿n fruit báº±ng TweenService
local function teleportToFruit(fruit)
    if fruit and fruit:FindFirstChild("Handle") and LocalPlayer.Character then
        local rootPart = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if rootPart then
            local goal = {CFrame = fruit.Handle.CFrame}
            local tweenInfo = TweenInfo.new(2, Enum.EasingStyle.Linear, Enum.EasingDirection.Out)
            local tween = TweenService:Create(rootPart, tweenInfo, goal)
            tween:Play()
            tween.Completed:Wait()
        end
    end
end

-- ğŸ“¦ LÆ°u trá»¯ fruit vÃ o inventory
local function storeFruitInInventory(fruit)
    if fruit and fruit:FindFirstChild("Handle") then
        local args = {
            [1] = fruit.Name,
            [2] = fruit.Handle.Position
        }
        
        local maxAttempts = 5
        local attempt = 0
        local success = false
        
        while attempt < maxAttempts do
            local successCall, result = pcall(function()
                return ReplicatedStorage.Remotes:FindFirstChild("StoreFruit"):InvokeServer(unpack(args))
            end)

            if successCall then
                success = true
                break
            else
                attempt = attempt + 1
                warn("[StoreFruit]: Thá»­ láº§n " .. attempt .. " tháº¥t báº¡i! Äang thá»­ láº¡i...")
                wait(1)
            end
        end

        return success
    end
    return false
end

-- ğŸ”„ Äá»•i server sau 5 giÃ¢y náº¿u lÆ°u fruit thÃ nh cÃ´ng
local function switchServer()
    for i = 5, 1, -1 do
        print("ğŸ”„ Äá»•i server sau: " .. i .. " giÃ¢y")
        wait(1)
    end

    TeleportService:Teleport(game.PlaceId, LocalPlayer)
end

-- ğŸ“Œ Kiá»ƒm tra & Nháº·t Fruit
local function checkAndPickFruit()
    local fruit = findNearestFruit()

    if fruit then
        print("âœ… ÄÃ£ TÃ¬m Tháº¥y Fruit! " .. fruit.Name)
        teleportToFruit(fruit)
        wait(1)
        local stored = storeFruitInInventory(fruit)
        
        if stored then
            print("ğŸ“¦ ÄÃ£ lÆ°u trá»¯ fruit vÃ o kho!")
            switchServer()
        else
            print("âš ï¸ KhÃ´ng thá»ƒ lÆ°u trá»¯ fruit! Äang tÃ¬m server má»›i...")
            switchServer()
        end
    else
        print("âŒ KhÃ´ng cÃ³ fruit!")
        switchServer()
    end
end

checkAndPickFruit()
