local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local VirtualUser = game:GetService("VirtualUser")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")

-- üîÑ‚õ≥Ô∏è Ch·∫∑n AFK
LocalPlayer.Idled:Connect(function()
    VirtualUser:CaptureController()
    VirtualUser:ClickButton2(Vector2.new())
end)

-- üè¥ T·ª± ƒë·ªông ch·ªçn H·∫£i T·∫∑c khi v√†o game
if game.PlaceId == 2753915549 or game.PlaceId == 4442272183 or game.PlaceId == 7449423635 then
    local args = { [1] = "SetTeam", [2] = "Pirates" }
    ReplicatedStorage.Remotes.CommF_:InvokeServer(unpack(args))
    wait(1)
    ReplicatedStorage.Remotes.CommF_:InvokeServer("TeleportToSpawn")
end

-- üìå T·∫°o UI hi·ªÉn th·ªã tr√™n m√†n h√¨nh
local function CreateUI()
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "PlowHubUI"
    screenGui.Parent = game.Players.LocalPlayer:FindFirstChild("PlayerGui") or game.CoreGui

    local Frame = Instance.new("Frame", screenGui)
    Frame.Size = UDim2.new(0, 320, 0, 160)
    Frame.Position = UDim2.new(0.5, -160, 0.05, 0)
    Frame.BackgroundColor3 = Color3.new(0, 0, 0)
    Frame.BackgroundTransparency = 0.3
    Frame.BorderSizePixel = 2

    -- üåê Ti√™u ƒë·ªÅ UI
    local Title = Instance.new("TextLabel", Frame)
    Title.Size = UDim2.new(1, 0, 0.2, 0)
    Title.TextScaled = true
    Title.TextColor3 = Color3.fromRGB(173, 216, 230)
    Title.BackgroundTransparency = 1
    Title.Text = "üåê Plow Game | Community"

    -- üîç Khung Tr·∫°ng th√°i tr√°i √°c qu·ª∑
    local StatusFrame = Instance.new("Frame", Frame)
    StatusFrame.Size = UDim2.new(0.9, 0, 0.4, 0)
    StatusFrame.Position = UDim2.new(0.05, 0, 0.3, 0)
    StatusFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    StatusFrame.BackgroundTransparency = 0.2

    local StatusLabel = Instance.new("TextLabel", StatusFrame)
    StatusLabel.Size = UDim2.new(1, 0, 1, 0)
    StatusLabel.TextSize = 18
    StatusLabel.TextColor3 = Color3.new(1, 1, 1)
    StatusLabel.BackgroundTransparency = 1
    StatusLabel.Text = "üîé ƒêang ki·ªÉm tra tr√°i √°c qu·ª∑..."

    -- üéØ FPS Counter
    local FpsLabel = Instance.new("TextLabel", Frame)
    FpsLabel.Size = UDim2.new(1, 0, 0.15, 0)
    FpsLabel.Position = UDim2.new(0, 0, 0.75, 0)
    FpsLabel.TextSize = 16
    FpsLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
    FpsLabel.BackgroundTransparency = 1
    FpsLabel.Text = "FPS: 60"

    -- üéØ C·∫≠p nh·∫≠t FPS theo th·ªùi gian th·ª±c
    RunService.RenderStepped:Connect(function()
        local fps = math.floor(1 / RunService.RenderStepped:Wait())
        FpsLabel.Text = "FPS: " .. fps
    end)

    return StatusLabel
end

-- üìå Kh·ªüi t·∫°o UI
local StatusLabel = CreateUI()

-- üîç T√¨m tr√°i √°c qu·ª∑ nhanh h∆°n
local function FindFruits()
    for _, fruit in pairs(game.Workspace:GetChildren()) do
        if fruit:IsA("Tool") and string.find(fruit.Name, "Fruit") then
            return fruit
        end
    end
    return nil
end

-- üìç D·ªãch chuy·ªÉn ƒë·∫øn tr√°i
local function TeleportToPosition(position)
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        LocalPlayer.Character.HumanoidRootPart.CFrame = position
    end
end

-- ‚úÖ L∆∞u tr·ªØ tr√°i v√†o kho
local function StoreFruit(fruitName)
    ReplicatedStorage.Remotes.CommF_:InvokeServer("StoreFruit", fruitName)
    StatusLabel.Text = "‚úÖ ƒê√£ l∆∞u tr·ªØ tr√°i " .. fruitName .. "!"
end

-- üåê **T·ª± ƒë·ªông Server Hop si√™u t·ªëc**
local function ServerHopWithCountdown()
    -- ƒê·∫øm ng∆∞·ª£c 5 gi√¢y
    for i = 5, 1, -1 do
        wait(1)
    end

    -- API ƒë·ªÉ l·∫•y danh s√°ch c√°c server
    local success, servers = pcall(function()
        return HttpService:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/2753915549/servers/Public?sortOrder=Asc&limit=100"))
    end)

    -- Ki·ªÉm tra n·∫øu vi·ªác l·∫•y server th√†nh c√¥ng
    if not success or not servers or not servers.data then
        StatusLabel.Text = "‚ùå Kh√¥ng th·ªÉ l·∫•y danh s√°ch server!"
        return
    end

    local foundServer = false
    local bestServer = nil

    -- L·ªçc c√°c server c√≥ √≠t ng∆∞·ªùi ch∆°i v√† ch·ªçn server t·ªët nh·∫•t
    for _, server in ipairs(servers.data) do
        -- Ki·ªÉm tra xem server c√≥ th√¥ng tin h·ª£p l·ªá kh√¥ng
        if server.playing and server.maxPlayers and server.id then
            -- N·∫øu s·ªë ng∆∞·ªùi ch∆°i √≠t h∆°n t·ªëi ƒëa, ch·ªçn server ƒë√≥
            if server.playing < server.maxPlayers then
                if not bestServer or server.playing < bestServer.playing then
                    bestServer = server
                end
            end
        end
    end

    -- N·∫øu kh√¥ng t√¨m th·∫•y server ph√π h·ª£p
    if not bestServer then
        StatusLabel.Text = "‚ùå Kh√¥ng t√¨m th·∫•y server ph√π h·ª£p!"
        return
    end

    -- Th·ª≠ chuy·ªÉn ƒë·∫øn server ƒë√£ ch·ªçn
    local success, errorMsg = pcall(function()
        TeleportService:TeleportToPlaceInstance(game.PlaceId, bestServer.id, LocalPlayer)
    end)

    if success then
        foundServer = true
    else
        StatusLabel.Text = "‚ùå L·ªói khi chuy·ªÉn server: " .. errorMsg
    end

    -- N·∫øu kh√¥ng th√†nh c√¥ng, hi·ªÉn th·ªã th√¥ng b√°o l·ªói
    if not foundServer then
        StatusLabel.Text = "‚ùå Kh√¥ng th·ªÉ chuy·ªÉn ƒë·∫øn server."
    end
end

-- üîÅ **T√¨m & nh·∫∑t tr√°i, sau ƒë√≥ t·ª± ƒë·ªông Server Hop v·ªõi ƒë·∫øm ng∆∞·ª£c**
while true do
    local fruit = FindFruits()
    if fruit then
        StatusLabel.Text = "üçè ƒê√£ t√¨m th·∫•y tr√°i √°c qu·ª∑!"
        TeleportToPosition(fruit.Handle.CFrame)
        wait(1)

        -- üèÜ Nh·∫∑t tr√°i & l∆∞u v√†o kho
        LocalPlayer.Character.Humanoid:EquipTool(fruit)
        wait(1)
        StoreFruit(fruit.Name)
    else
        StatusLabel.Text = "‚ùå Kh√¥ng c√≥ tr√°i! Chu·∫©n b·ªã chuy·ªÉn server..."
        ServerHopWithCountdown()
    end

    wait(5) -- ‚è≥ Ch·ªù 5 gi√¢y tr∆∞·ªõc khi ki·ªÉm tra ti·∫øp
end
